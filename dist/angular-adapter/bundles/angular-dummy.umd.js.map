{"version":3,"file":"angular-dummy.umd.js","sources":["../../../projects/angular-adapter/src/lib/csvbox-button.component.ts","../../../projects/angular-adapter/src/lib/csvbox-angular.module.ts","../../../projects/angular-adapter/src/public-api.ts","../../../projects/angular-adapter/src/angular-dummy.ts"],"sourcesContent":["import { Component, OnInit, ViewChild, Input, OnChanges, SimpleChanges } from '@angular/core';\nimport { DomSanitizer, SafeUrl } from '@angular/platform-browser';\n\n@Component({\n  selector: 'csvbox-button',\n  template: `\n    <div>\n      <button disabled (click)=\"openModal()\" data-csvbox-initator [attr.data-csvbox-token]=\"uuid\">\n        <ng-content></ng-content>\n      </button>\n      <div #holder class=\"holder\" attr.id=\"csvbox-embed-{{ uuid }}\">\n        <iframe #iframe class=\"iframe\" [src]=\"safeUrl\" [attr.data-csvbox-token]=\"uuid\"></iframe>\n      </div>\n    </div>\n  `,\n  styles: [\n    `\n      .holder{\n        z-index: 2147483647;\n        position: fixed;\n        top: 0;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        display: none;\n      }\n      .iframe{\n        height: 100%;\n        width: 100%;\n        position: absolute;\n        top: 0px;\n        left: 0px;\n      }\n    `\n  ]\n})\n\nexport class CSVBoxButtonComponent implements OnInit, OnChanges {\n\n  isModalShown = false;\n\n  @ViewChild('holder') holder: any;\n  @ViewChild('iframe') iframe: any;\n  @Input() onImport: Function;\n  @Input() onReady: Function;\n  @Input() onClose: Function;\n  @Input() onSubmit: Function;\n\n  @Input() user: Object;\n  @Input() dynamicColumns: Object;\n  @Input() licenseKey: String;\n  @Input() options: Object;\n  @Input() uuid: String = null;\n  @Input() debugMode: boolean;\n  @Input() useStagingServer: boolean;\n\n  safeUrl:SafeUrl;\n\n  constructor(public sanitizer:DomSanitizer) {}\n\n  ngOnInit(): void {\n    this.uuid = this.generateUuid();\n    if(this.debugMode) {\n      console.log(`[Csvbox-${this.uuid}]`,\"UUID:\");\n      console.log(`[Csvbox-${this.uuid}]`,\"License key:\", this.licenseKey);\n      console.log(`[Csvbox-${this.uuid}]`,`Using ${this.useStagingServer ? 'staging' : 'live'} server` );\n    }\n    let url = `https://${this.useStagingServer ? 'staging' : 'app' }.csvbox.io/embed/${this.licenseKey}`;\n\n    url += \"?library-version=2\";\n\n    this.safeUrl = this.sanitizer.bypassSecurityTrustResourceUrl(url);\n  }\n\n  generateUuid(): string {\n    return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if(changes[\"user\"] && changes['user'].currentValue != changes['user'].previousValue) {\n      this.updateUserVariabe(changes['user'].currentValue);\n    }\n  }\n\n  updateUserVariabe(data): void {\n    this.user = data;\n    this.iframe?.nativeElement?.contentWindow?.postMessage({\n      \"customer\" : data\n    }, \"*\");\n  }\n\n  ngAfterViewInit(): void {\n    window.addEventListener(\"message\", (event) => {\n\n      if(this.debugMode) { console.log(`[Csvbox-${this.uuid}]`, \"Message:\", event); }\n\n      if (event?.data === \"mainModalHidden\") {\n        this.holder.nativeElement.style.display = 'none';\n        this.isModalShown = false;\n        this.onClose?.();\n      }\n      if(event?.data === \"uploadSuccessful\") {\n        this.onImport(true);\n      }\n      if(event?.data === \"uploadFailed\") {\n        this.onImport(false);\n      }\n      if(typeof event?.data == \"object\") {\n        if(event?.data?.data?.unique_token == this.uuid) {\n          if(event.data.type && event.data.type == \"data-on-submit\") {\n            let metadata = event.data.data;\n            metadata[\"column_mappings\"] = event.data.column_mapping;\n            // this.callback(true, metadata);\n            delete metadata[\"unique_token\"];\n            this.onSubmit?.(metadata);\n        }\n        else if(event.data.type && event.data.type == \"data-push-status\") {\n            if(event.data.data.import_status == \"success\") {\n                // this.callback(true, event.data.data);\n                if(event?.data?.row_data) {\n                    let primary_row_data = event.data.row_data;\n                    let headers = event.data.headers;\n                    let rows = [];\n                    let dynamic_columns_indexes = event.data.dynamicColumnsIndexes;\n                    primary_row_data.forEach((row_data) => {\n                        let x = {};\n                        let dynamic_columns = {};\n                        row_data.data.forEach((col, i)=>{\n\n                            if(col == undefined){ col = \"\"};\n\n                            if(dynamic_columns_indexes.includes(i)) {\n                                dynamic_columns[headers[i]] = col;\n                            }else{\n                                x[headers[i]] = col;\n                            }\n                        });\n                        if(row_data?.unmapped_data) {\n                            x[\"_unmapped_data\"] = row_data.unmapped_data;\n                        }\n                        if(dynamic_columns && Object.keys(dynamic_columns).length > 0) {\n                            x[\"_dynamic_data\"] = dynamic_columns;\n                        }\n                        rows.push(x);\n                    });\n                    let metadata = event.data.data;\n                    metadata[\"rows\"] = rows;\n                    delete metadata[\"unique_token\"];\n                    this.onImport(true, metadata);\n                }else{\n                    let metadata = event.data.data;\n                    delete metadata[\"unique_token\"];\n                    this.onImport(true, metadata);\n                }\n            }else {\n                let metadata = event.data.data;\n                delete metadata[\"unique_token\"];\n                this.onImport(false, metadata);\n            }\n        }\n\n\n        }\n      }\n    }, false);\n\n    let iframe = this.iframe.nativeElement;\n    // let user = this.user;\n    // let dynamicColumns = this.dynamicColumns;\n    // let options = this.options;\n    // let uuid = this.uuid;\n\n    let self = this;\n\n    iframe.onload = function () {\n\n      if(self.debugMode) { console.log(`[Csvbox-${self.uuid}]`,\"iframe loaded\"); }\n\n      self.onReady?.();\n\n      self.enableInitator();\n\n      iframe.contentWindow.postMessage({\n        \"customer\" : self.user ? self.user : null,\n        \"columns\" : self.dynamicColumns ? self.dynamicColumns : null,\n        \"options\" : self.options ? self.options : null,\n        \"unique_token\": self.uuid\n      }, \"*\");\n\n    }\n  }\n  enableInitator(){\n    let initator = document.querySelector(`[data-csvbox-initator][data-csvbox-token=\"${this.uuid}\"]`) as HTMLButtonElement;\n    if(initator && initator.disabled !== undefined) {\n      initator.disabled = false;\n    }\n  }\n  openModal(): void {\n    if(!this.isModalShown) {\n      this.isModalShown = true;\n      this.iframe.nativeElement.contentWindow.postMessage('openModal', '*');\n      this.holder.nativeElement.style.display = 'block';\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CSVBoxButtonComponent } from './csvbox-button.component';\n\n\n\n@NgModule({\n  declarations: [\n    CSVBoxButtonComponent\n  ],\n  imports: [\n  ],\n  exports: [\n    CSVBoxButtonComponent\n  ]\n})\nexport class CSVBoxAngularModule { }\n","/*\n * Public API Surface of angular-adapter\n */\n\n// export * from './lib/angular-adapter.service';\nexport * from './lib/csvbox-button.component';\nexport * from './lib/csvbox-angular.module';\nexport * from './lib/interfaces/interface';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["Component","ViewChild","Input","NgModule"],"mappings":"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"}